window.mineSweeper={},function(a){"use strict";a.GridItem=function(b,c){var d=this;d.x=b,d.y=c,d.isBomb=ko.observable(!1),d.numberOfBombs=ko.observable(0),d.open=ko.observable(!1),d.displayClass=ko.computed(function(){return d.isBomb()&&d.open()?"topcoat-notification":a.numberClasses[d.numberOfBombs()]}),d.display=ko.computed(function(){var a="";return d.open()&&!d.isBomb()&&(a=0!==d.numberOfBombs()?d.numberOfBombs():""),a})},a.numberClasses=["none","one","two","three","four","five","six"]}(this.mineSweeper=this.mineSweeper||{}),function(a){"use strict";a.Level=function(a){var b=this;return a=a||{},b.description=a.description,b.rows=a.rows,b.cols=a.cols,b.bombs=a.bombs,b.winningCondition=function(a){return a===b.rows*b.cols-b.bombs},b}}(this.mineSweeper=this.mineSweeper||{}),function(a){"use strict";a.MineSweeperViewModel=function(){var b=this;b.activeGame=ko.observable(!1),b.openNum=ko.observable(0),b.grid=ko.observableArray(),b.bombs=ko.observableArray(),b.level=ko.observable(),b.seconds=ko.observable(0),b.minutes=ko.observable(0),b.timeDisplay=function(a){return 9>a?"0"+a:a},b.secondsDisplay=ko.computed(function(){return b.timeDisplay(b.seconds())}),b.minutesDisplay=ko.computed(function(){return b.timeDisplay(b.minutes())}),b.levels=[new a.Level({description:"Easy",rows:9,cols:9,bombs:10}),new a.Level({description:"Intermediate",rows:16,cols:16,bombs:40}),new a.Level({description:"Hard",rows:30,cols:16,bombs:99})],b.generateGrid=function(){b.activeGame(!1),b.openNum(0);for(var c=[],d=0;d<b.level().rows;d++){c[d]=[];for(var e=0;e<b.level().cols;e++)c[d][e]=new a.GridItem(d,e)}b.grid(c),b.generateBombs(),b.activeGame(!0),b.seconds(0),b.minutes(0),b.timer=a.Timer(),b.timer.start(function(a){b.seconds(a.seconds),b.minutes(a.minutes)}),$("#game-lost").hide(),$("#game-won").hide()},b.generateBombs=function(){b.bombs([]);for(var a=function(a){a.numberOfBombs(a.numberOfBombs()+1)},c=0;c<b.level().bombs;c++){var d=b.generateSingleBomb();b.bombs().push(d),b.updateNeighbors(d,a)}},b.generateSingleBomb=function(){var a;return function c(){for(a=b.grid()[b.getRandomInt(0,b.level().rows-1)][b.getRandomInt(0,b.level().cols-1)];a.isBomb();)c()}(),a.isBomb(!0),a},b.updateNeighbors=function(a,c){for(var d=function(a,c){return 0>a||a>=b.level().rows||0>c||c>=b.level().cols?!1:!0},e=a.x-1;e<=a.x+1;e++)for(var f=a.y-1;f<=a.y+1;f++)d(e,f)&&c&&c(b.grid()[e][f])},b.OpenItem=function(a){if(b.activeGame()&&!a.open()){if(a.isBomb())return b.endGameLose(),void 0;a.open(!0),b.openNum(b.openNum()+1),b.level().winningCondition(b.openNum())&&b.endGameWin(),0===a.numberOfBombs()&&b.updateNeighbors(a,function(a){a.isBomb()||b.OpenItem(a)})}},b.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},b.endGameLose=function(){b.displayAllBombs(),b.activeGame(!1),b.timer.stop(),$("#game-lost").show()},b.endGameWin=function(){b.displayAllBombs(),b.activeGame(!1),b.timer.stop(),$("#game-won").show()},b.displayAllBombs=function(){for(var a=0;a<b.bombs().length;a++)b.bombs()[a].open(!0)}}}(this.mineSweeper=this.mineSweeper||{}),function(a){"use strict";a.Timer=function(){var a=this,b=0,c=0,d=function(){a.stopTimer||(b=(b+1)%60,0===b&&(c=(c+1)%60),a.callback({seconds:b,minutes:c}),setTimeout(d,1e3))},e=function(b){a.stopTimer=!1,a.callback=b,d()},f=function(){a.stopTimer=!0};return{tick:d,start:e,stop:f}}}(this.mineSweeper=this.mineSweeper||{});